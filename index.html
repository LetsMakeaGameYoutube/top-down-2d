<html>
  <head> </head>
  <body style="background-color: #222">
    <canvas
      id="canvas"
      width="600"
      height="400"
      style="background-color: #efefef"
    ></canvas>
    <script>
      const canvas = document.getElementById("canvas");
      const context = canvas.getContext("2d");

      const player = { x: 0, y: 0, w: 32, h: 48 };

      const controller = { w: false, a: false, s: false, d: false };

      const map = [];

      const MAP_H = 30;
      const MAP_W = 30;
      const TILE_W = 32;

      document.addEventListener("keydown", (e) => {
        switch (e.keyCode) {
          case 87:
            controller.w = true;
            break;
          case 65:
            controller.a = true;
            break;
          case 83:
            controller.s = true;
            break;
          case 68:
            controller.d = true;
            break;
        }
      });

      document.addEventListener("keyup", (e) => {
        switch (e.keyCode) {
          case 87:
            controller.w = false;
            break;
          case 65:
            controller.a = false;
            break;
          case 83:
            controller.s = false;
            break;
          case 68:
            controller.d = false;
            break;
        }
      });

      function renderPlayer() {
        context.fillStyle = "#ff0000";
        context.fillRect(player.x, player.y, player.w, player.h);
      }

      function updatePlayer() {
        if (controller.w) {
          player.y -= 4;
        }
        if (controller.s) {
          player.y += 4;
        }
        if (controller.a) {
          player.x -= 4;
        }
        if (controller.d) {
          player.x += 4;
        }
      }

      function renderMap() {
        for (let i = 0; i < map.length; i++) {
          for (let j = 0; j < map[i].length; j++) {
            if (map[i][j] === 0) {
              context.fillStyle = "#efefef";
              context.fillRect(i * TILE_W, j * TILE_W, TILE_W, TILE_W);
              context.fillStyle = "#fff";
              context.fillRect(
                i * TILE_W + 1,
                j * TILE_W + 1,
                TILE_W - 1,
                TILE_W - 1
              );
            } else if (map[i][j] === 1) {
              context.fillStyle = "#44ee44";
              context.fillRect(i * TILE_W, j * TILE_W, TILE_W, TILE_W);
              context.fillStyle = "#88ff88";
              context.fillRect(i * TILE_W, j * TILE_W - 8, TILE_W, TILE_W / 2);
            }
          }
        }
      }

      function render() {
        context.clearRect(0, 0, canvas.width, canvas.height);
        renderMap();
        renderPlayer();
      }

      function initMap() {
        for (let i = 0; i < MAP_H; i++) {
          map.push([]);
          for (let j = 0; j < MAP_W; j++) {
            let tileValue = 0;
            const randValue = Math.floor(Math.random() * 10);
            if (randValue > 8) {
              tileValue = 1;
            }
            map[i].push(tileValue);
          }
        }
      }

      function run() {
        updatePlayer();
        render();
        setTimeout(run, 1000 / 60);
      }

      initMap();
      run();
    </script>
  </body>
</html>
